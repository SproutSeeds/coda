# Copy this file to .env.local and fill in project-specific secrets.

# Database connection string
# The app will read `DATABASE_URL`, `DATABASE_POSTGRES_URL`, `POSTGRES_URL`, `POSTGRES_PRISMA_URL`,
# `POSTGRES_URL_NON_POOLING`, `NEON_DATABASE_URL`, or `NEON_POSTGRES_URL` (first one defined wins).
DATABASE_URL="postgres://USER:PASSWORD@HOST:5432/coda"
# POSTGRES_URL="postgres://USER:PASSWORD@HOST:5432/coda"

# Auth.js configuration
NEXTAUTH_SECRET="change-me"
NEXTAUTH_URL="http://localhost:3000"

# Upstash Redis (rate limiting)
UPSTASH_REDIS_REST_URL="https://your-upstash-instance.upstash.io"
UPSTASH_REDIS_REST_TOKEN="upstash-token"

# Magic-link email (Auth.js Email provider)
EMAIL_SERVER="stream"           # use "stream" during local dev or supply SMTP host/connection string
EMAIL_PORT="587"
EMAIL_USER="smtp-username"
EMAIL_PASSWORD="smtp-password"
EMAIL_FROM="Coda <login@example.com>"

# Password verification fallback (Google Workspace SMTP recommended)
PASSWORD_EMAIL_SERVER="smtp.gmail.com"
PASSWORD_EMAIL_PORT="465"
PASSWORD_EMAIL_USER="cody@example.com"
PASSWORD_EMAIL_PASSWORD="app-password"
PASSWORD_EMAIL_FROM="Coda <cody@example.com>"

# Dev Mode tokens (optional for local dev)
DEV_MODE_ISS="coda-dev"
DEV_MODE_AUD="coda-dev"
# DEV_MODE_KID="kid-1"
# DEV_MODE_PRIVATE_PEM="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"

# Dev Mode bootstrap (local convenience)
# In development, set to true to auto-create Dev Mode tables if missing on first use.
# DO NOT enable this in production.
# DEVMODE_AUTO_BOOTSTRAP="true"

# Cloudflare Access audience (optional gating for runner endpoints)
# CF_ACCESS_AUD=""

# Web Push (optional)
# VAPID_PUBLIC_KEY=""
# VAPID_PRIVATE_KEY=""
# VAPID_SUBJECT="mailto:admin@codacli.com"

# Optional analytics/telemetry keys can be added here when enabled
# SENTRY_DSN=
# POSTHOG_API_KEY=

# Dev Mode Terminal (runner-local PTY → Cloudflare Tunnel)
# Local bind/port for the runner's PTY WebSocket server.
# Expose this via cloudflared and protect with Cloudflare Access for remote use.
# TTY_BIND="127.0.0.1"
# TTY_PORT="8787"

# Relay WebSocket (Fly.io or similar)
# Enable relay session flow in the UI (client-side)
NEXT_PUBLIC_DEVMODE_RELAY_ENABLED="0"
# Public relay URL for client-side pages (e.g., downloads). Keep in sync with DEVMODE_RELAY_URL.
NEXT_PUBLIC_DEVMODE_RELAY_URL=""
# Public app base URL for client rendering (avoids hydration mismatch).
# Example: https://www.codacli.com for production, or your preview URL.
NEXT_PUBLIC_SITE_URL=""
# Relay URL the server returns to the client; e.g., wss://relay-falling-butterfly-779.fly.dev
DEVMODE_RELAY_URL=""
# HS256 secret used by both the app (mint tokens) and relay (verify tokens)
DEVMODE_JWT_SECRET=""

# Internal callback (Relay → App) for token revocation checks
# Set this same value on the Relay service and your App; Relay calls the verify endpoint with this header.
RELAY_INTERNAL_SECRET=""

# Runner integration with Relay (optional)
# RELAY_URL="wss://relay-falling-butterfly-779.fly.dev"
# RUNNER_TOKEN="<long-lived HS256 token for this runner>"
